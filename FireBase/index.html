<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authentication</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div>
      <input type="text" id="username" name="username" placeholder="username" />
      <input type="text" id="email" name="email" placeholder="email" />
      <input
        type="password"
        id="password"
        name="password"
        placeholder="password"
      />
      <input type="submit" id="signUp" name="signup-submit" value="Sign Up" />
      <input type="submit" id="login" name="login" value="Login" />
      <input type="button" id="logout" name="logout" value="Logout" />
    </div>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
      import {
        getDatabase,
        set,
        ref,
      } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-auth.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCJUXuoMpUMJicrm1f9GwzGumDu1VlQaIg",
        authDomain: "authentication-app-123.firebaseapp.com",
        databaseURL:
          "https://authentication-app-123-default-rtdb.firebaseio.com",
        projectId: "authentication-app-123",
        storageBucket: "authentication-app-123.appspot.com",
        messagingSenderId: "273771978256",
        appId: "1:273771978256:web:b01b69bfc81d6065733495",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const auth = getAuth(app);

      document.getElementById("signUp").addEventListener("click", async (e) => {
        let email = document.getElementById("email").value;
        let username = document.getElementById("username").value;
        let password = document.getElementById("password").value;

        try {
          const userCredential = await createUserWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;

          // Check if username and email are defined before setting them in the database
          if (username && email) {
            await set(ref(database, "users/" + user.uid), {
              username: username,
              email: email,
            });
          }

          alert("User created");
        } catch (error) {
          const errorMessage = error.message;
          alert(errorMessage);
        }
      });

      document.getElementById("login").addEventListener("click", async (e) => {
        let email = document.getElementById("email").value;
        let password = document.getElementById("password").value;

        try {
          const userCredential = await signInWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;

          // Redirect to the profile page and pass user data as query parameters
          window.location.href = `profile.html?email=${user.email}&username=${user.displayName}`;
        } catch (error) {
          const errorMessage = error.message;
          // alert(errorMessage);
        }
      });

      // Logout function
      document.getElementById("logout").addEventListener("click", async (e) => {
        try {
          await signOut(auth);
          alert("User logged out");
        } catch (error) {
          const errorMessage = error.message;
          alert(errorMessage);
        }
      });
    </script>
  </body>
</html>
